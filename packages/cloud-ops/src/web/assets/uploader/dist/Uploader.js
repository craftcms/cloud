/*! For license information please see Uploader.js.LICENSE.txt */
!function(){function e(){var n,r,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.toStringTag||"@@toStringTag";function s(e,a,o,i){var s=a&&a.prototype instanceof u?a:u,c=Object.create(s.prototype);return t(c,"_invoke",function(e,t,a){var o,i,s,u=0,c=a||[],d=!1,f={p:0,n:0,v:n,a:h,f:h.bind(n,4),d:function(e,t){return o=e,i=0,s=n,f.n=t,l}};function h(e,t){for(i=e,s=t,r=0;!d&&u&&!a&&r<c.length;r++){var a,o=c[r],h=f.p,p=o[2];e>3?(a=p===t)&&(s=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=n):o[0]<=h&&((a=e<2&&h<o[1])?(i=0,f.v=t,f.n=o[1]):h<p&&(a=e<3||o[0]>t||t>p)&&(o[4]=e,o[5]=t,f.n=p,i=0))}if(a||e>1)return l;throw d=!0,t}return function(a,c,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&h(c,p),i=c,s=p;(r=i<2?n:s)||!d;){o||(i?i<3?(i>1&&(f.n=-1),h(i,s)):f.n=s:f.v=s);try{if(u=2,o){if(i||(a="next"),r=o[a]){if(!(r=r.call(o,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=o.return)&&r.call(o),i<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=n}else if((r=(d=f.n<0)?s:e.call(t,f))!==l)break}catch(e){o=n,i=1,s=e}finally{u=1}}return{value:r,done:d}}}(e,o,i),!0),c}var l={};function u(){}function c(){}function d(){}r=Object.getPrototypeOf;var f=[][o]?r(r([][o]())):(t(r={},o,function(){return this}),r),h=d.prototype=u.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=d,t(h,"constructor",d),t(d,"constructor",c),c.displayName="GeneratorFunction",t(d,i,"GeneratorFunction"),t(h),t(h,i,"Generator"),t(h,o,function(){return this}),t(h,"toString",function(){return"[object Generator]"}),(e=function(){return{w:s,m:p}})()}function t(e,n,r,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}t=function(e,n,r,a){function i(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!a,configurable:!a,writable:!a}):e[n]=r:(i("next",0),i("throw",1),i("return",2))},t(e,n,r,a)}function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}function r(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){a(i,r,o,s,l,"next",e)}function l(e){a(i,r,o,s,l,"throw",e)}s(void 0)})}}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,s=[],l=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var u,c,d;Craft.CloudUploader=Craft.BaseUploader.extend({element:null,$fileInput:null,_totalBytes:0,_uploadedBytes:0,_lastUploadedBytes:0,_validFileCounter:0,_handleChange:null,init:function(e,t){var n=this;t=$.extend({},Craft.CloudUploader.defaults,t),this.base(e,t),this.element=e[0],this.$dropZone=t.dropZone,this._handleChange=this.handleChange.bind(this),this.$fileInput.on("change",this._handleChange),Object.entries(this.settings.events).forEach(function(e){var t=i(e,2),r=t[0],a=t[1];n.element.addEventListener(r,a)}),this.allowedKinds&&!this._extensionList&&this._createExtensionList(),this.$dropZone&&this.$dropZone.on({dragover:function(e){n.handleDragEvent(e)&&(e.originalEvent.dataTransfer.dropEffect="copy")},drop:function(e){n.handleDragEvent(e)&&n.uploadFiles(e.originalEvent.dataTransfer.files)},dragenter:this.handleDragEvent,dragleave:this.handleDragEvent})},handleDragEvent:function(e){var t;return!(null==e||null===(t=e.originalEvent)||void 0===t||null===(t=t.dataTransfer)||void 0===t||!t.files||(e.preventDefault(),e.stopPropagation(),0))},uploadFiles:(d=o(e().m(function t(a){var o,i,s,l,u,c,d=this;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(o=r(a),i=o.filter(function(e){var t,n=!0;if(null!==(t=d._extensionList)&&void 0!==t&&t.length){var r=e.name.match(/\.([a-z0-4_]+)$/i)[1];d._extensionList.includes(r.toLowerCase())||(d._rejectedFiles.type.push("“"+e.name+"”"),n=!1)}return d.settings.maxFileSize&&e.size>d.settings.maxFileSize&&(d._rejectedFiles.size.push("“"+e.name+"”"),n=!1),n&&"function"==typeof d.settings.canAddMoreFiles&&!d.settings.canAddMoreFiles(d._validFileCounter)&&(d._rejectedFiles.limit.push("“"+e.name+"”"),n=!1),n&&(d._totalBytes+=e.size,d._validFileCounter++,d._inProgressCounter++),n}),this.processErrorMessages(),!(this._validFileCounter>0)){e.n=8;break}this.element.dispatchEvent(new Event("fileuploadstart")),s=n(i),e.p=1,s.s();case 2:if((l=s.n()).done){e.n=5;break}return u=l.value,e.n=3,this.uploadFile(u);case 3:this._inProgressCounter--;case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,c=e.v,s.e(c);case 7:return e.p=7,s.f(),e.f(7);case 8:this._validFileCounter=0,this._totalBytes=0,this._uploadedBytes=0,this._lastUploadedBytes=0,this._inProgressCounter=0;case 9:return e.a(2)}},t,this,[[1,6,7,8]])})),function(e){return d.apply(this,arguments)}),uploadFile:(c=o(e().m(function t(n){var r,a,o,i,s,l,u,c=this;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=Object.assign({},this.formData,{filename:n.name}),e.p=1,e.n=2,Craft.sendActionRequest("POST","cloud/assets/get-upload-url",{data:r});case 2:return a=e.v,e.n=3,axios.put(a.data.url,n,{headers:{"Content-Type":n.type},onUploadProgress:function(e){c._uploadedBytes=c._uploadedBytes+e.loaded-c._lastUploadedBytes,c._lastUploadedBytes=e.loaded,c.element.dispatchEvent(new CustomEvent("fileuploadprogressall",{detail:{loaded:c._uploadedBytes,total:c._totalBytes}}))}});case 3:return Object.assign(r,a.data,{size:n.size,lastModified:n.lastModified}),e.n=4,this.getImage(n);case 4:return(o=e.v)&&(i=o.width,s=o.height,Object.assign(r,{width:i,height:s})),e.n=5,axios.post(this.settings.url,r);case 5:a=e.v,this.element.dispatchEvent(new CustomEvent("fileuploaddone",{detail:a.data})),e.n=7;break;case 6:e.p=6,u=e.v,this.element.dispatchEvent(new CustomEvent("fileuploadfail",{detail:{message:null==u||null===(l=u.response)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.message,filename:n.name}}));case 7:return e.p=7,this._lastUploadedBytes=0,this.element.dispatchEvent(new Event("fileuploadalways")),e.f(7);case 8:return e.a(2)}},t,this,[[1,6,7,8]])})),function(e){return c.apply(this,arguments)}),handleChange:function(e){this.uploadFiles(e.target.files),this.$fileInput.val("")},getImage:(u=o(e().m(function t(n){var r;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=new Image,e.p=1,r.src=URL.createObjectURL(n),e.n=2,r.decode();case 2:URL.revokeObjectURL(r.src),e.n=4;break;case 3:return e.p=3,e.v,e.a(2,null);case 4:return e.a(2,r)}},t,null,[[1,3]])})),function(e){return u.apply(this,arguments)}),destroy:function(){var e=this;this.$fileInput.off("change",this._handleChange),this.$dropZone.off("dragover drop dragenter dragleave"),Object.entries(this.settings.events).forEach(function(t){var n=i(t,2),r=n[0],a=n[1];e.element.removeEventListener(r,a)})}},{defaults:{maxFileSize:null,createAction:"cloud/assets/create-asset",replaceAction:"cloud/assets/replace-file"}}),Craft.registerUploaderClass("craft\\cloud\\fs\\AssetsFs",Craft.CloudUploader)}();
//# sourceMappingURL=Uploader.js.map